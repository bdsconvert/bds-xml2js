<html>
  <head>
    <title>bds-xml2js</title>
  </head>
  <body>
    <h4>BDS-XML2JS</h4>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.21.1/parser.js"></script>
    
    <script>
      const xml = `
        <Product xmlns="http://ns.editeur.org/onix/3.0/reference">
          <RecordReference>9780545582957</RecordReference>
          <ProductIdentifier>
                <ProductIDType>03</ProductIDType>
                <IDValue>9780545582957</IDValue>
          </ProductIdentifier>
          <DescriptiveDetail>
                <ProductComposition>00</ProductComposition>
                <ProductForm>BC</ProductForm>
                <TitleDetail>
                  <TitleType>01</TitleType>
                  <TitleElement>
                    <TitleElementLevel>01</TitleElementLevel>
                    <TitleText>Harry Potter and the Goblet of Fire</TitleText>
                  </TitleElement>
                </TitleDetail>
                <Contributor>
                  <SequenceNumber>1</SequenceNumber>
                  <ContributorRole>A01</ContributorRole>
                  <PersonName>J. K. Rowling</PersonName>
                </Contributor>
          </DescriptiveDetail>
        </Product>
      `;
      
      function flatten(obj, parent) {
        let objflat = {};
        let flat = function (obj, parent) {
          for (let key in obj) {
            if (typeof obj[key] === "object" && obj[key] !== null && Array.isArray(obj[key]) === false) {
              flat(obj[key], parent + "_" + key);
            } else if (Array.isArray(obj[key]) === true) {
              flat({ ...obj[key] }, parent + "_" + key);
            } else {
              objflat[parent + "_" + key] = obj[key];
            }
          }
        };
        flat(obj, parent);
        return objflat;
      }
      const result = parser.validate(xml);
      if(result !== true) cnosole.log(result.err);
      const js = parser.parse(xml);
      console.log(flatten(js, "Product"));
    </script>

  </body>
</html>
